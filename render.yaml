# render.yaml - Blueprint para Deploy no Render
# Documentação: https://render.com/docs/blueprint-spec

databases:
  # Banco de Dados PostgreSQL Gerenciado pelo Render
  - name: embrapa-db
    databaseName: vitivinicultura
    user: embrapa_user
    # Você selecionará o plano no dashboard do Render

services:
  # Serviço 1: Cache Redis Gerenciado pelo Render
  - type: redis # <<< CORRIGIDO: Definido como um serviço
    name: embrapa-cache
    plan: free # Plano free para Redis geralmente funciona bem no YAML
    # A variável REDIS_URL será injetada automaticamente nos serviços conectados

  # Serviço 2: API Backend (Flask/Gunicorn )
  - type: web
    name: embrapa-api
    runtime: docker
    repo: https://github.com/gustavoimbelloni/projeto-embrapa # Render preenche automaticamente
    branch: master # Ou main, ajuste conforme sua branch principal
    dockerfilePath: ./backend/Dockerfile
    dockerContext: ./backend
    envVars:
      - key: FLASK_APP
        value: src.main:app
      - key: FLASK_ENV
        value: production
      # Conexão com o Banco de Dados Gerenciado
      - key: DATABASE_URL
        fromDatabase:
          name: embrapa-db
          property: connectionString
      # Conexão com o Cache Redis Gerenciado
      - key: REDIS_URL
        fromService: # <<< CORRIGIDO: Usa fromService
          type: redis # <<< CORRIGIDO: Especifica o tipo redis
          name: embrapa-cache
          property: connectionString

  # Serviço 3: Frontend (Next.js )
  - type: web
    name: embrapa-frontend
    runtime: docker
    repo: https://github.com/gustavoimbelloni/projeto-embrapa # Render preenche automaticamente
    branch: master # Ou main, ajuste conforme sua branch principal
    dockerfilePath: ./frontend/Dockerfile
    dockerContext: ./frontend
    envVars:
      # Conecta o Frontend à URL interna da API no Render
      - key: NEXT_PUBLIC_API_URL
        fromService:
          type: web
          name: embrapa-api
          property: url
